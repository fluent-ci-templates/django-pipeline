# Django Pipeline

[![deno module](https://shield.deno.dev/x/django_pipeline)](https://deno.land/x/django_pipeline)
![deno compatibility](https://shield.deno.dev/deno/^1.34)
[![](https://img.shields.io/codecov/c/gh/fluent-ci-templates/django-pipeline)](https://codecov.io/gh/fluent-ci-templates/django-pipeline)

A ready-to-use GitLab CI Pipeline and Jobs for your Django projects.

## ðŸš€ Usage

Quick start:

```ts
import { GitLab } from "https://deno.land/x/django_pipeline/mod.ts";

const { pipeline } = GitLab;

pipeline.write(); // Write the pipeline to the file .gitlab-ci.yml
```

Or, if you want to use the predefined jobs:

```ts
import { GitlabCI } from "https://deno.land/x/fluent_gitlab_ci/mod.ts";
import { GitLab } from "https://deno.land/x/django_pipeline/mod.ts";

const { install, migrations, djangoTests } = GitLab;

const const pipeline = new GitlabCI()
  .variables({
    MYSQL_DATABASE: "$MYSQL_DB",
    MYSQL_ROOT_PASSWORD: "$MYSQL_PASS",
    MYSQL_USER: "$MYSQL_USER",
    MYSQL_PASSWORD: "$MYSQL_PASS",
  })
  .addJob("install", install)
  .addJob("migrations", migrations)
  .addJob("django-tests", djangoTests);

pipeline.write(); // Write the pipeline to the file .gitlab-ci.yml
```

It will generate the following `.gitlab-ci.yml` file:

```yaml
# Do not edit this file directly. It is generated by Fluent GitLab CI

variables:
  MYSQL_DATABASE: $MYSQL_DB
  MYSQL_ROOT_PASSWORD: $MYSQL_PASS
  MYSQL_USER: $MYSQL_USER
  MYSQL_PASSWORD: $MYSQL_PASS

install:
  image: ubuntu:20.04
  services:
    - mysql:8.0
  cache:
    paths:
      - ~/.cache/pip/
  before_script:
    - apt -y update
    - apt -y install apt-utils
    - apt -y install net-tools python3.8 python3-pip mysql-client libmysqlclient-dev
    - apt -y upgrade
    - pip3 install -r requirements.txt

migrations:
  stage: build
  script:
    - python3 manage.py makemigrations
    - python3 manage.py migrate
    - python3 manage.py check

django-tests:
  stage: test
  script:
    - echo "GRANT ALL on *.* to '${MYSQL_USER}';"| mysql -u root --password="${MYSQL_ROOT_PASSWORD}" -h mysql
    - python3 manage.py test
```


## ðŸ§ª Advanced Usage

This package also provides a ready-to-use pipeline for
[Dagger](https://dagger.io/), just run the following command on your Django project:

```sh
dagger run deno run -A https://deno.land/x/django_pipeline/ci.ts
```

Or, if you want to use the predefined jobs:

```ts
import Client, { connect } from "@dagger.io/dagger";
import { Dagger } from "https://deno.land/x/django_pipeline/mod.ts";

const { djangoTests } = Dagger;

function pipeline(src = ".") {
  connect(async (client: Client) => {
    await djangoTests(client, src);
  });
}

pipeline();
```